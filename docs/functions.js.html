<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: functions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: functions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * A function that executes a callback with a fixed framerate using requestAnimationFrame
 * @param {loopCallback} callback - The function to be executed 
 * @param {number} [target=60] - The target framerate
 * @returns {loopReturn} loopReturn
 */
function loop(callback, target = 60) {
    let animateId = null;
    let frame = 0;
    let time = performance.now();
    let delta = -1;
    let steps = -1;
    let fps = -1;
    let average = -1;
    let lazy = {
        status: false,
        time: 0,
        frames: 0
    };
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') lazy.status = false;
        else lazy.status = true;
    });


    const animate = () => {
        let now = performance.now();
        delta = now - time;
        if (delta > 1000 / (target + 5)) { // Add some leeway of 5 fps - seems to correct target fps at any value
            if (steps > 0) steps--;
            time = now;
            frame++;
            if(lazy.status) {
                lazy.frames++;
                lazy.time += delta;
            }
            fps = Math.round(1000 / delta);
            average = Math.round(frame / time * 1000);
            callback({ frame, fps, target, time, delta, animateId, steps, average, lazy });
        }
        if (steps != 0) animateId = requestAnimationFrame(animate);
        else {
            cancelAnimationFrame(animateId);
            steps = -1;
        }
    };

    return {
        start: function () {
            animate();
            return { frame, fps, target, time, delta, animateId, steps, average, lazy };
        },
        stop: function () {
            steps = 0;
            return { frame, fps, target, time, delta, animateId, steps, average, lazy };
        },
        step: function (frames = 1) {
            steps = frames;
            return { frame, fps, target, time, delta, animateId, steps, average, lazy };
        },
        status: function () {
            return { frame, fps, target, time, delta, animateId, steps, average, lazy };
        },
        onresize: function (callback) {
            window.addEventListener('resize', callback);
            window.addEventListener('load', callback);
        }
    };
}

/**
 * Inverts a HEX color string
 * @param {string} hex - HEX color string with #
 * @returns {string} string
 */
function invertColorString(hex) {
    let r = (255 - parseInt(hex.substring(1, 3), 16)).toString(16).padStart(2, '0');
    let g = (255 - parseInt(hex.substring(3, 5), 16)).toString(16).padStart(2, '0');
    let b = (255 - parseInt(hex.substring(5, 7), 16)).toString(16).padStart(2, '0');
    let o = hex.substring(7, 9); // opacity should be the same
    return '#' + r + g + b + o;
}

/**
 * Get an css variable in :root
 * @param {string} name - The name of the variable
 * @param {boolean} [number=false] - Whether to return a number
 * @returns {string|number} string|number
 */
function getCSSVariable(name, number = false) {
    let value = getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);
    // remove any css units (last characters of string only)
    value = value.replace(/(px|em|rem|%|vw|vh|em)$/, '');
    if (number === true) return parseFloat(value);
    return value;
}

/**
 * Takes the window element and returns a width or height
 * @param {HTMLElement} elem 
 * @returns {{width: number, height: number}}
 */
const FIT = (elem) => {
    return {
        width: elem.scrollWidth,
        height: elem.scrollHeight
    };
}

/**
 * Generator function that returns an incrementing number
 * @generator
 * @yields {string} string
 */
 function* incrementGenerator(start = 0, padding = 4) {
    while (true) yield `${start++}`.padStart(padding, '0');
}

/**
 * Generator function that returns the lowest awailable number
 * The generator can make a number available again by calling release
 * @generator
 * @param {number} [max=99] - The maximum number to be returned
 * @param {number} [min=1] - The minimum number to be returned
 * @yields {listTrackerYield} listTrackerYield
 */
function* listTrackerGenerator(max = 99, min = 1) {
    let list = [...Array(max - min + 1).keys()].map(x => x + min);
    while (true) yield {
        number: list.shift(),
        empty: list.length === 0,
        release: (number) => {
            // If the number is not already in the list, add it
            if (list.includes(number)) return false;
            list.push(number);
            list.sort((a, b) => a - b);
            return true;
        }
    };
    
} 

/**
 * Global incrementing number generator
 * 
 */
const increment = incrementGenerator();

/**
 * (Mathmatical expression Sigma) returns an array of the results of the expression
 * @param {callback&lt;number>} callback - The expression to be evaluated called with n
 * @param {number} start - "Safe" to use -Infinity
 * @param {number} end - "Safe" to use Infinity
 * @param {boolean} [intermitent=false] - Whether to return an imediate array or a number
 * @returns {any[]|number} any[]|number
 */
function sum(callback, start, end, intermitent = false) {
    // function should handle +/-Infinity variable
    if (start === -Infinity) start = -Number.MAX_SAFE_INTEGER;
    if (end === Infinity) end = Number.MAX_SAFE_INTEGER;
    let sum = [];
    for (let n = start; n &lt; end; n++) sum.push(callback(n));
    // if intermitent is false, return the sum as an array
    if (intermitent === true) return sum;
    // else return the sum as a number
    while (sum.length > 0) sum = sum.reduce((a, b) => a + b);
    return sum;
}

/**
 * Converts radians to degrees
 * @param {number} rad - Radian value
 * @returns {number} number
 */
function radToDeg(rad) {
    return rad * 180 / Math.PI;
}

/**
 * Converts degrees to radians
 * @param {number} deg - Degree value
 * @returns {number} number
 */
function degToRad(deg) {
    return deg * Math.PI / 180;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Canvas.html">Canvas</a></li><li><a href="Complex.html">Complex</a></li><li><a href="Coordinate.html">Coordinate</a></li><li><a href="Desktop.html">Desktop</a></li><li><a href="FourierSeries.html">FourierSeries</a></li><li><a href="Graph.html">Graph</a></li><li><a href="ImageStyle.html">ImageStyle</a></li><li><a href="Kinematic.html">Kinematic</a></li><li><a href="Layered.html">Layered</a></li><li><a href="LineStyle.html">LineStyle</a></li><li><a href="Matrix.html">Matrix</a></li><li><a href="Series.html">Series</a></li><li><a href="Style.html">Style</a></li><li><a href="TextStyle.html">TextStyle</a></li><li><a href="TimeDomain.html">TimeDomain</a></li><li><a href="Vector.html">Vector</a></li></ul><h3>Global</h3><ul><li><a href="global.html#defaultWindowOptions">defaultWindowOptions</a></li><li><a href="global.html#degToRad">degToRad</a></li><li><a href="global.html#FIT">FIT</a></li><li><a href="global.html#getCSSVariable">getCSSVariable</a></li><li><a href="global.html#increment">increment</a></li><li><a href="global.html#incrementGenerator">incrementGenerator</a></li><li><a href="global.html#invertColorString">invertColorString</a></li><li><a href="global.html#listTrackerGenerator">listTrackerGenerator</a></li><li><a href="global.html#loop">loop</a></li><li><a href="global.html#radToDeg">radToDeg</a></li><li><a href="global.html#sum">sum</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Tue Aug 30 2022 17:22:43 GMT+0200 (Centraleurop√¶isk sommertid)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
